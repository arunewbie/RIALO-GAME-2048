<!-- ===============================
  RIALO GAME 2048 MUMET LUR â€” Project Bundle
  Files in this canvas:
  1) index.html
  2) game.js
  Place your icon at: /icon/favicon.png
=================================== -->

<!-- ================= FILE: index.html ================= -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RIALO GAME 2048 MUMET LUR</title>
  <link rel="icon" type="image/png" href="./icon/favicon.png">
  <style>
    :root{
      --bg:#faf8ef;--board:#bbada0;--empty:#cdc1b4;--tile:#eee4da;--text:#776e65;--white:#f9f6f2;--accent:#8f7a66;--tile-size:1px;
    }
    [data-theme="dark"]{ --bg:#171614;--board:#2b2723;--empty:#3b352f;--tile:#6b5f55;--text:#f5eee6;--white:#fffaf2;--accent:#d5c2a8; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--text);display:grid;place-items:center;min-height:100svh;padding:18px}
    .wrap{max-width:560px;width:100%}
    header{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;margin-bottom:10px}
    h1{font-size:34px;line-height:1;margin:0;color:var(--accent)}
    .scores{display:flex;gap:8px}
    .badge{background:#bbada0;color:var(--white);border-radius:8px;padding:8px 10px;text-align:center;min-width:90px}
    [data-theme="dark"] .badge{background:#4a4139}
    .badge .label{font-size:12px;opacity:.9}
    .badge .value{font-weight:800;font-size:20px}
    .controls{display:grid;grid-template-columns:1fr;gap:10px;margin:10px 0 14px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    button, select, label.switch{appearance:none;border:0;cursor:pointer;background:#8f7a66;color:var(--white);padding:10px 14px;border-radius:10px;font-weight:700}
    button.secondary{background:#bbada0}
    [data-theme="dark"] button.secondary{background:#4a4139}
    select{cursor:pointer}
    label.switch{display:inline-flex;align-items:center;gap:8px}
    label.switch input{accent-color:#8f7a66}
    .board{position:relative;aspect-ratio:1/1;background:var(--board);border-radius:14px;padding:12px;display:grid;grid-template-columns:repeat(var(--n,4),1fr);gap:12px;box-shadow:0 8px 24px rgba(0,0,0,.08)}
    .cell{background:var(--empty);border-radius:10px}
    .tile{position:absolute;inset:auto;display:grid;place-items:center;font-weight:800;border-radius:10px;color:var(--text);transition:transform var(--anim,.08s) ease, background .15s ease;will-change:transform}
    .tile-inner{font-size:34px}
    .tile{width:var(--tile-size);height:var(--tile-size);transform:translate(var(--x),var(--y)) scale(1)}
    .pop{animation:pop .12s ease}
    @keyframes pop{0%{transform:scale(.9)}100%{transform:scale(1)}}
    .v2{background:#eee4da}.v4{background:#ede0c8}.v8{background:#f2b179;color:var(--white)}.v16{background:#f59563;color:var(--white)}.v32{background:#f67c5f;color:var(--white)}.v64{background:#f65e3b;color:var(--white)}.v128{background:#edcf72;color:var(--white)}.v256{background:#edcc61;color:var(--white)}.v512{background:#edc850;color:var(--white)}.v1024{background:#edc53f;color:var(--white)}.v2048{background:#edc22e;color:var(--white)}
    .shake{animation:shake .25s}
    @keyframes shake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}
    .overlay{position:absolute;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;border-radius:14px}
    .overlay.show{display:flex}
    .card{background:#8f7a66;color:var(--white);padding:16px 18px;border-radius:12px;text-align:center;max-width:80%}
    .notice{margin-top:10px;text-align:center;font-weight:700}
    .small{font-size:12px;opacity:.7}
    .creator{text-align:center;font-size:14px;margin-top:12px;opacity:.85}
    .creator a{color:var(--accent);text-decoration:none;font-weight:800}
    @media (max-width:420px){h1{font-size:28px}.tile-inner{font-size:28px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>RIALO GAME 2048 MUMET LUR</h1>
      <div class="scores">
        <div class="badge"><div class="label">SCORE</div><div class="value" id="score">0</div></div>
        <div class="badge"><div class="label">BEST</div><div class="value" id="best">0</div></div>
      </div>
    </header>

    <div class="controls">
      <div class="row">
        <button id="newBtn">New Game</button>
        <button class="secondary" id="undoBtn" title="Undo last move (up to 5)">Undo</button>
        <button class="secondary" id="resetBestBtn" title="Reset best score for this size">Reset Best</button>
      </div>
      <div class="row">
        <label class="switch"><input type="checkbox" id="themeToggle"> Dark mode</label>
        <label class="switch"><input type="checkbox" id="soundToggle" checked> Sound</label>
        <label class="switch"><input type="checkbox" id="hardToggle"> Hard mode (no 4s)</label>
        <label class="switch"><input type="checkbox" id="fastToggle"> Fast anim</label>
        <select id="sizeSel" title="Board size">
          <option value="3">3Ã—3</option>
          <option value="4" selected>4Ã—4</option>
          <option value="5">5Ã—5</option>
          <option value="6">6Ã—6</option>
        </select>
      </div>
    </div>

    <div class="board" id="board" aria-label="2048 board" role="application"></div>
    <div class="overlay" id="overlay"><div class="card" id="overlayMsg"></div></div>
    <div class="notice small">Arrow keys / WASD or swipe. Settings persist locally.</div>
    <div class="creator">Created by <a href="https://github.com/arunewbie" target="_blank" rel="noopener">Arunewbie</a></div>
  </div>

  <script type="module" src="./game.js"></script>
</body>
</html>


<!-- ================= FILE: game.js ================= -->
// RIALO GAME 2048 MUMET LUR â€” core logic (no external libs)
// DOM refs
const boardEl = document.getElementById('board');
const scoreEl = document.getElementById('score');
const bestEl  = document.getElementById('best');
const newBtn  = document.getElementById('newBtn');
const undoBtn = document.getElementById('undoBtn');
const resetBestBtn = document.getElementById('resetBestBtn');
const sizeSel = document.getElementById('sizeSel');
const themeToggle = document.getElementById('themeToggle');
const soundToggle = document.getElementById('soundToggle');
const hardToggle = document.getElementById('hardToggle');
const fastToggle = document.getElementById('fastToggle');
const overlay = document.getElementById('overlay');
const overlayMsg = document.getElementById('overlayMsg');

let N = 4; // board size
let tiles = []; // {id,value,x,y, merged:false,pop?:bool}
let score = 0; let best = 0; let nextId = 1;
let undoStack = []; // up to 5 states

const cfgKey = 'cfg-2048';
const stateKey = 'state-2048';

// Storage helper (avoid private mode errors)
function storage(){ try{ return window.localStorage }catch{ return {getItem(){},setItem(){},removeItem(){}} } }
const LS = storage();
function keyBest(){ return `best-2048-${N}` }

function setTheme(dark){ document.documentElement.setAttribute('data-theme', dark? 'dark':'' ); themeToggle.checked=!!dark }

function beep(type='merge'){
  if(!soundToggle.checked) return;
  try{
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    const osc = ctx.createOscillator(); const gain = ctx.createGain();
    osc.type = 'sine'; osc.frequency.value = type==='merge'? 620 : 220;
    gain.gain.value = 0.06; osc.connect(gain); gain.connect(ctx.destination);
    osc.start(); setTimeout(()=>{osc.stop(); ctx.close()}, type==='merge'? 90:120);
  }catch{}
}
function vibrate(ms=20){ if(navigator.vibrate) navigator.vibrate(ms) }
function updateAnimSpeed(){ boardEl.style.setProperty('--anim', fastToggle.checked? '.04s':'.08s') }

// Grid helpers
function buildStaticGrid(){
  boardEl.innerHTML=''; boardEl.style.setProperty('--n', N);
  const gap=12, pad=12; const rect=boardEl.getBoundingClientRect();
  const cellSize = (rect.width - pad*2 - gap*(N-1)) / N;
  boardEl.style.setProperty('--tile-size', cellSize + 'px');
  for(let i=0;i<N*N;i++){ const cell=document.createElement('div'); cell.className='cell'; boardEl.appendChild(cell) }
}
function coordsToPx(x,y){ const gap=12,pad=12; const sizePx=parseFloat(getComputedStyle(boardEl).getPropertyValue('--tile-size')); const pxX=pad + x*(sizePx+gap); const pxY=pad + y*(sizePx+gap); return {x:pxX+'px', y:pxY+'px'} }
function drawTiles(){
  [...boardEl.querySelectorAll('.tile')].forEach(n=>n.remove());
  tiles.forEach(t=>{ const d=document.createElement('div'); d.className=`tile v${t.value} ${t.pop?'pop':''}`; const {x,y}=coordsToPx(t.x,t.y); d.style.setProperty('--x',x); d.style.setProperty('--y',y); const inner=document.createElement('div'); inner.className='tile-inner'; inner.textContent=t.value; d.appendChild(inner); boardEl.appendChild(d); t.pop=false; });
}
function emptyCells(){ const occ=new Set(tiles.map(t=>t.y*N+t.x)); const out=[]; for(let y=0;y<N;y++) for(let x=0;x<N;x++){ const idx=y*N+x; if(!occ.has(idx)) out.push({x,y}) } return out }
function addRandomTile(){ const empties=emptyCells(); if(!empties.length) return false; const spot=empties[Math.floor(Math.random()*empties.length)]; const value = Math.random() < (hardToggle.checked? 1:0.9) ? 2 : 4; tiles.push({id:nextId++, value, x:spot.x, y:spot.y, pop:true}); return true }
function cellContent(x,y){ return tiles.find(t=>t.x===x && t.y===y) || null }

// Move logic
function within(x,y){ return x>=0 && x<N && y>=0 && y<N }
function vectorFor(dir){ return [ {x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0} ][dir] }
function buildTraversal(dir){ const xs=[...Array(N).keys()], ys=[...Array(N).keys()]; const v=vectorFor(dir); if(v.x===1) xs.reverse(); if(v.y===1) ys.reverse(); return {xs,ys} }
function saveUndo(){ const snap={N, tiles:JSON.parse(JSON.stringify(tiles)), score, nextId}; undoStack.push(snap); if(undoStack.length>5) undoStack.shift() }
function restoreUndo(){ const snap=undoStack.pop(); if(!snap) return; N=snap.N; tiles=JSON.parse(JSON.stringify(snap.tiles)); score=snap.score; nextId=snap.nextId; sizeSel.value=String(N); best = +LS.getItem(keyBest())||0; bestEl.textContent=best; scoreEl.textContent=score; buildStaticGrid(); drawTiles(); overlay.classList.remove('show'); persistState() }
function move(dir){
  saveUndo(); let moved=false; let gained=0; const {xs,ys}=buildTraversal(dir); const v=vectorFor(dir); tiles.forEach(t=>t.merged=false);
  for(const y of ys){ for(const x of xs){ const tile=cellContent(x,y); if(!tile) continue; let nx=tile.x, ny=tile.y; while(true){ const px=nx+v.x, py=ny+v.y; if(!within(px,py)) break; const next=cellContent(px,py); if(next){ if(!next.merged && !tile.merged && next.value===tile.value){ next.value*=2; next.merged=true; gained+=next.value; beep('merge'); vibrate(15); tiles = tiles.filter(t=>t.id!==tile.id); tile.x=px; tile.y=py; moved=true; next.pop=true; } break; } else { nx=px; ny=py; } } if(nx!==tile.x||ny!==tile.y){ tile.x=nx; tile.y=ny; moved=true } } }
  if(moved){ score+=gained; scoreEl.textContent=score; if(score>best){ best=score; LS.setItem(keyBest(),best); bestEl.textContent=best } addRandomTile(); drawTiles(); persistState(); checkEnd(); }
  else{ boardEl.classList.remove('shake'); void boardEl.offsetWidth; boardEl.classList.add('shake'); beep('block') }
}
function movesAvailable(){ if(emptyCells().length) return true; for(let y=0;y<N;y++) for(let x=0;x<N;x++){ const t=cellContent(x,y); if(!t) continue; const r=cellContent(x+1,y); if(r&&r.value===t.value) return true; const d=cellContent(x,y+1); if(d&&d.value===t.value) return true } return false }
function checkEnd(){ if(tiles.some(t=>t.value===2048)){ showOverlay('ðŸŽ‰ You made 2048! Keep going or start a new game.') } else if(!movesAvailable()){ showOverlay('ðŸ’€ Game Over â€” No moves left.') } }
function showOverlay(msg){ overlayMsg.textContent=msg; overlay.classList.add('show') }
overlay.addEventListener('click', ()=> overlay.classList.remove('show'))

// Persistence
function persistCfg(){ const cfg={N, dark:themeToggle.checked, sound:soundToggle.checked, hard:hardToggle.checked, fast:fastToggle.checked}; LS.setItem(cfgKey, JSON.stringify(cfg)) }
function loadCfg(){ try{ const cfg=JSON.parse(LS.getItem(cfgKey)||'{}'); if(cfg.N) N=cfg.N; sizeSel.value=String(N); themeToggle.checked=!!cfg.dark; soundToggle.checked = cfg.sound!==false; hardToggle.checked=!!cfg.hard; fastToggle.checked=!!cfg.fast; setTheme(themeToggle.checked); updateAnimSpeed(); }catch{} }
function persistState(){ const st={N, tiles, score, nextId}; LS.setItem(stateKey, JSON.stringify(st)) }
function tryResume(){ try{ const st=JSON.parse(LS.getItem(stateKey)||'null'); if(!st) return false; N=st.N; tiles=st.tiles||[]; score=st.score||0; nextId=st.nextId||1; sizeSel.value=String(N); return true }catch{ return false } }

// Setup
function setup(newBoard=false){ undoStack.length=0; overlay.classList.remove('show'); buildStaticGrid(); if(newBoard || tiles.length===0){ tiles=[]; score=0; nextId=1; addRandomTile(); addRandomTile(); } best=+LS.getItem(keyBest())||0; bestEl.textContent=best; scoreEl.textContent=score; drawTiles(); persistState() }

// Inputs
window.addEventListener('keydown', (e)=>{ const map={ArrowUp:0,KeyW:0,ArrowRight:1,KeyD:1,ArrowDown:2,KeyS:2,ArrowLeft:3,KeyA:3}; const code=map[e.code]; if(code===undefined) return; e.preventDefault(); move(code) }, {passive:false});
let touchStart=null; boardEl.addEventListener('touchstart', e=>{ const t=e.changedTouches[0]; touchStart={x:t.clientX,y:t.clientY,time:Date.now()} }, {passive:true}); boardEl.addEventListener('touchend', e=>{ if(!touchStart) return; const t=e.changedTouches[0]; const dx=t.clientX-touchStart.x, dy=t.clientY-touchStart.y; const adx=Math.abs(dx), ady=Math.abs(dy); const dt=Date.now()-touchStart.time; touchStart=null; if(Math.max(adx,ady)<20||dt>600) return; if(adx>ady) move(dx>0?1:3); else move(dy>0?2:0) }, {passive:true});

// UI controls
newBtn.addEventListener('click', ()=>{ tiles=[]; score=0; nextId=1; setup(true) });
undoBtn.addEventListener('click', ()=> restoreUndo());
resetBestBtn.addEventListener('click', ()=>{ LS.removeItem(keyBest()); best=0; bestEl.textContent=best });
sizeSel.addEventListener('change', ()=>{ N=+sizeSel.value; persistCfg(); tiles=[]; score=0; nextId=1; setup(true) });
themeToggle.addEventListener('change', ()=>{ setTheme(themeToggle.checked); persistCfg() });
soundToggle.addEventListener('change', ()=> persistCfg());
hardToggle.addEventListener('change', ()=> persistCfg());
fastToggle.addEventListener('change', ()=>{ updateAnimSpeed(); persistCfg() });

// Responsive rebuild
let rT; window.addEventListener('resize', ()=>{ clearTimeout(rT); rT=setTimeout(()=>{ buildStaticGrid(); drawTiles(); }, 80) });

// Init
loadCfg(); if(!tryResume()){ addRandomTile(); addRandomTile() } setup();
